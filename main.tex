\documentclass[conference]{IEEEtran}
\usepackage{savesym}
\usepackage{amsmath,amssymb,amsfonts,amsthm}
\usepackage[numbers]{natbib}
\usepackage{algorithm}
\usepackage[noend]{algpseudocode}
\usepackage{comment}
\usepackage{xspace}
\usepackage{scalerel}
\usepackage{xcolor}
\usepackage[caption=false,font=footnotesize]{subfig}
\usepackage[left]{showlabels}
\usepackage{multicol}
\usepackage[bookmarks=true]{hyperref}

\begin{document}

\title{	Online, interactive user guidance for \\
		high-dimensional, constrained motion planning }

\author{Fahad Islam, Oren Salzman and Maxim Likhachev}


\maketitle
\thispagestyle{empty}
\pagestyle{empty}

\input{macros.tex}

\begin{abstract}

\end{abstract}

\IEEEpeerreviewmaketitle

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Intro
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\begin{comment}
\section{Introduction}
\label{sec:intro}

Motion-planning is a fundamental problem in robotics that has been studied for over four decades. 
However, efficiently planning paths in high-dimensional, constrained spaces remains an ongoing challenge.
One approach to address this challenge is to incorporate user guidance.
While there has been much work on planning using human demonstration 
%(see, e.g.,~\cite{HS16, PHCL16, SHLA16, YA17} for a partial list), 
(see, e.g.,~\cite{SHLA16, YA17} for a partial list), 
there has been surprisingly little research incorporating guidance as an interactive part of the planning loop.

Broadly speaking, interactive planning has been typically used in the context of sampling-based motion-planning algorithms.
%~\cite{L06}.
User guidance is employed by biasing the sampling-scheme of the planner.
This can be done by having the user mark regions in the \emph{workspace} that should be avoided or 
explored~\cite{DSJA14}.
%explored~\cite{DSJA14, MTMKDC15, YPB15}.
Alternatively interactive devices such as a 3D mouse or a haptic arm have been used to generate paths in a (low-dimensional) configuration space. This path is then used by a planner to bias its 
sampling domain~\cite{TFF12}.
%sampling domain~\cite{BTFF16, FTF09, TFF12}.
%Interestingly, in all the examples mentioned, an implicit assumption taken is that the user is dedicated to guide and interact with the planning algorithm.

We are interested in planning in high-dimensional, constrained spaces such as those encountered by a humanoid robot (see Fig.~\ref{Fig:robot}).
In such settings, workspace regions often give little guidance to the planner due to the dimension of the configuration space as well as the physical constraints of the robot.
Similarly, obtaining user guidance in the configuration space is extremely time consuming, even for expert users.

Thus,  while beneficial, user guidance should be employed scarcely.
Our key insight is that carefully chosen individual configurations suggested by a user can be used to effectively guide the planner.


Transforming this insight into a planning framework requires addressing three fundamental questions:

\begin{itemize}
	\item[\textbf{Q1.}] When should the planner ask the user for guidance?
	\item[\textbf{Q2.}] What form should the user's guidance take?
	\item[\textbf{Q3.}] How should the guidance be used?
\end{itemize}
 
In the following, we detail our planning framework (Sec.~\ref{sec:high}) and how it addresses each of these questions (Sec.~\ref{sec:q1}-\ref{sec:q3}).
We then continue (Sec.~\ref{sec:eval}) to demonstrate its effectiveness in simulations and conclude by describing possible additional future work.

%\algrenewcommand\algorithmicindent{.8em}
\begin{algorithm}[tb]
\caption{Planning framework ($\A$)}
\label{alg:main}	
\begin{algorithmic}[1]
\small
\While{$\neg\A.$\texttt{is\_solution\_found()} } 
	\While{$\neg\A.$\texttt{is\_in\_local\_minima()}} 
		\State $\A.$\texttt{run()}
		\Comment{no user guidance}
	\EndWhile
	
	\State {$g \leftarrow$ \texttt{get\_user\_guidance()}}
	\Comment{$\A$ is in a local minima}
	\State $\A.$\texttt{update\_user\_guidance($g$)}
	\Comment{account for guidance}
	\While{$\A.$\texttt{is\_in\_local\_minima()}}
		\State $\A.$\texttt{run()}
		\Comment{planner uses guidance}
	\EndWhile

	\State $\A.$\texttt{update\_user\_guidance($\neg g$)}
	\Comment {remove  guidance}
\EndWhile
\end{algorithmic}
\end{algorithm}

\section{Planning framework}
\label{sec:planning}
\subsection{High-level approach}
\label{sec:high}
To employ our planning framework, we assume that we are given a motion-planning algorithm $\A$ that is endowed with two non-standard procedures which are planner dependant.
The first, \texttt{is\_in\_local\_minima()}, 
identifies when $\A$ is in a \emph{local minima}. Namely when its search does not progress towards the goal. 
The second, \texttt{update\_user\_guidance()}, 
incorporates (or removes) the guidance provided by the user to the planner. 

Equipped with these functions, we can describe our planning framework, detailed in Alg.~\ref{alg:main}.
The framework runs as long as no solution is found (line~1).
It runs the planner~$\A$ (lines~2-3) as long as it continuously makes progresses towards the goal (namely, it is not in a local minima).
Once a local minima is identified, user guidance is invoked (line~4) and $\A$  is updated to make use of this guidance (line~5).
It is then run while using the guidance as long as it is still in the local minima (lines~6-7).
Once it escapes the local minima $\A$ is updated to remove the guidance that was provided by the user (line~8).


We demonstrate our planning framework for the case where the motion-planning algorithm $\A$ is multi-heuristic A* (MHA*)~\cite{ASNHL16}.
MHA* is a search-based planning algorithm that takes in multiple, arbitrarily inadmissible heuristic functions in addition to a single consistent heuristic.
It uses them simultaneously to search the configuration space in an A*-like manner that was shown to be both complete and ensures bounds on sub-optimality. 
This allows the search to efficiently combine the guiding powers of different heuristic functions. 


\subsection{Invoking user guidance}
\label{sec:q1}
The heuristic functions of search-based planning algorithms, such as MHA*, can be used to estimate in a principled manner when the planner is in a local minima. 
Specifically, recall that in such algorithms,  we proceed by iteratively choosing  the current-best state from a priority queue and computing all its successors. We suggest several approaches to identify when the planner is in a local minima.

The first is \os{describe expansion delay}.
The second is \os{describe heuristic progress}.
% when the key of the node popped at the current iteration is larger than the key of the node popped at the previous iteration.

Once a local minima is identified, it can then be used to trigger the event that the search does not progress towards the goal. 
However, should we immediately ask for user guidance? If we are in a shallow local minima, providing the planner with additional computation time (possibly much shorter than the time required by the user to produce guidance) may be sufficient.
This is an example of the ski rental problem in which there is a tradeoff between continuing to pay a repeating cost (letting the algorithm try to escape its local minima) or paying a one-time cost which eliminates or reduces the repeating cost (invoking user guidance).
Indeed, by using a randomized approach we can obtain a $\frac{e}{e-1}\approx1.58$ competitive ratio\footnote{The competitive ratio of an online algorithm \texttt{ALG} is the ratio between the performance of \texttt{ALG} and the performance of an optimal offline algorithm.}~\cite{KMMO94}.
Indeed, this approach has already been used to identify when robots should ask for help from a user~\cite{RV12}.

\subsection{Form of user guidance}
\label{sec:q2}
We chose to obtain user guidance in the form of an intermediate configuration $\hat{q}$ that is used to guide the planner. We discuss alternative options in Sec~\ref{sec:future}.

The framework includes a graphical user interface (GUI) capable of  depicting the robot and the workspace.
Once user guidance is invoked, 
a configuration in the local minima is obtained and the robot is placed in that configuration (as well as the start and target configurations) in the GUI.
This allows the user to try and understand where the planner faces difficulty and how to guide it out of the local minima.
The user then suggests the guidance $\hat{q}$ by moving the robot's joints and end effectors.

\subsection{Using user guidance}
\label{sec:q3}
Recall that MHA* has at least one admissible heuristic $h_{0}$.
Furthermore, we assume that there exists a family of admissible\footnote{\os{do they have to be admissible?}} heuristic function $\H$, such that for every configuration~$q$, there exists a heuristic $h_q \in \H$ where $h_q(s)$ estimates the cost to reach $q$ from state $s$.
%%%%

Given a user guide in the form of a configuration $\hat{q}$, we dynamically generate a new heuristic $\hat{h} = h_{\hat{q}} + h_0$.
Namely,~$\hat{h}$ estimates the 
cost to reach the goal (via the term $h_0$) by passing through $\hat{q}$ (via the term $h_{\hat{q}}$).
Equipped with the heuristic $\hat{h}$, we add a new queue to the MHA* algorithm prioritized using the heuristic $\hat{h}$. 
States expanded using this queue will be biased towards $\hat{q}$.
Note that in the MHA* algorithm,nodes are shared between the different queues.
Thus, once a state has been found that can be used to get the planner out of the local minima, it will be expanded by the other queues using their heuristics.
Once this is detected, the newly-added queue is removed.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Evaluation
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Evaluation and future work}\label{sec:eval}
We implemented the planning framework described in Sec~\ref{sec:planning} for the case of a humanoid robot. We gave the robot the task of climbing up a set of stairs while avoiding collision with obstacles as well as adhering to the physical constraints of the robot.

As we can see \os{detail experiment}

While providing promising initial results, our framework is far from being complete.
We are interested in experimenting with alternative forms of user guidance such as providing a \emph{constrained submanifolds} of the configuration space. This may be used to guide the humanoid to use the railing while planning the stairs.
Furthermore, we would like to have a \emph{recursive} implementation of our framework.
Namely, the planner can be in a local minima while trying to escape a local minima. This should be identified and then the user should either (i)~provide new guidance or 
(ii)~provide  guidance  toward the previoulsy provided guidance.
Finally, once a guide is given, we want our planner to be able to \emph{generalize} the guidance obtained to future local minima that are similar in nature to the ones encountered.

%\newpage

%\bibliographystyle{plainnat}
\bibliographystyle{abbrv}
\bibliography{bibliography}

\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
